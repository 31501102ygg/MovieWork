<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>Yip Tang Movie</title>
	<link rel="shortcut icon" href="img/pic/html_16px_1210190_easyicon.net.ico" />
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<!-- Material Design Bootstrap -->
	<link href="css/mdb.min.css" rel="stylesheet">
	<!-- Your custom styles (optional) -->
	<link href="css/style.css" rel="stylesheet">
	<style type="text/css">
		.searchbar {
			margin-top: 70px;
		}

		.input-group.md-form.form-sm.form-1 input {
			border: 1px solid #bdbdbd;
			border-top-right-radius: 0.25rem;
			border-bottom-right-radius: 0.25rem;
		}

		.input-group.md-form.form-sm.form-2 input {
			border: 1px solid #bdbdbd;
			border-top-left-radius: 0.25rem;
			border-bottom-left-radius: 0.25rem;
		}

		.page-footer,
		.top-nav-collapse {
			background-color: #4285f4;
		}

		@media (max-width: 767px) {
			.insertimgs {
				width: 100%;
				height: 380px;
			}
			.imgrow {
				width: 80%;
				margin-left: 10%;
			}
		}

		@media (min-width: 768px) and (max-width: 991px) {
			.insertimgs {
				width: 100%;
				height: 260px;
			}
		}

		@media (min-width: 992px) {
			.insertimgs {
				width: 100%;
				height: 230px;
			}
			div.row {
				margin-top: 40px;
			}
		}
	</style>
</head>

<body>
	<!--Navbar-->
	<nav class="navbar navbar-expand-lg navbar-dark  blue darken-3 fixed-top scrolling-navbar">
		<div class="container">
			<!-- Navbar brand -->
			<a class="navbar-brand" href="#">
				<img src="img/pic/logo.png">
			</a>

			<!-- Collapse button -->
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav" aria-controls="basicExampleNav"
			 aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<!-- Collapsible content -->
			<div class="collapse navbar-collapse" id="basicExampleNav">

				<!-- Links -->
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="nav-link" href="./main1.html">热映电影
							<span class="sr-only">(current)</span>
						</a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="./searchfilms.html">寻找电影</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="./filmreview.html">影评</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="./personcollect.html">个人收藏</a>
					</li>
					<!-- Dropdown -->
					<!--<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
						<div class="dropdown-menu dropdown-primary" aria-labelledby="navbarDropdownMenuLink">
							<a class="dropdown-item" href="#">Action</a>
							<a class="dropdown-item" href="#">Another action</a>
							<a class="dropdown-item" href="#">Something else here</a>
						</div>
					</li>-->

				</ul>
				<!-- Links -->
				<ul class="navbar-nav mr-auto nav-flex-icons">
					<li class="nav-item">
						<a class="nav-link waves-effect waves-light" href="./aboutus.html">
							<i class="fa fa-gear"></i> 关于我们</a>
					</li>
					<li class="nav-item">
						<a class="nav-link waves-effect waves-light" href="./contact.html">
							<i class="fa fa-envelope"></i> 联系我们</a>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle waves-effect waves-light" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							<i class="fa fa-user"></i> 用户名称
						</a>
						<div class="dropdown-menu dropdown-menu-right dropdown-default" aria-labelledby="navbarDropdownMenuLink">
							<a class="dropdown-item waves-effect waves-light" href="./account.html">我的账号</a>
							<a class="dropdown-item waves-effect waves-light" href="#">退出</a>
						</div>
					</li>
				</ul>
			</div>
			<!-- Collapsible content -->
		</div>
	</nav>
	<!--/.Navbar-->
	<div class="searchbar">
		<div class="container">
			<div class="input-group md-form form-sm form-1 pl-0">
				<div class="input-group-prepend">
					<span class="input-group-text cyan lighten-2" id="basic-text1">
						<i class="fa fa-search text-white" aria-hidden="true"></i>
					</span>
				</div>
				<input id="sInput" class="form-control my-0 py-1 col-md-6 col-lg-4" type="text" placeholder="电影搜索" aria-label="Search">
			</div>
		</div>
	</div>

	<div class="selectbar">
		<div class="container">
			<!--Navbar-->
			<nav class="navbar navbar-expand-lg navbar-dark primary-color">

				<!-- Collapse button -->
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav2" aria-controls="basicExampleNav"
				 aria-expanded="false" aria-label="Toggle navigation">
					电影种类
					<span class="navbar-toggler-icon"></span>
				</button>

				<!-- Collapsible content -->
				<div class="collapse navbar-collapse" id="basicExampleNav2">

					<!-- Links -->
					<ul id="typetag" class="navbar-nav mr-auto">
						<li class="nav-item active">
							<a class="nav-link" value="">全部</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" value="喜剧">喜剧</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" value="动作">动作</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" value="爱情">爱情</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" value="剧情">剧情</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" value="动画">动画</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" value="科幻">科幻</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" value="惊悚">惊悚</a>
						</li>
					</ul>

				</div>

				<!-- Collapsible content -->

			</nav>
			<!--/.Navbar-->
		</div>
	</div>
	<!-- Start your project here-->
	<div class="mainFilms">
		<div id="mainFilms" class="container"></div>
	</div>

	<div class="dtfy">
		<div class="container">

			<nav class="flex-center ">
				<ul class="pagination pg-blue pagination-circle pagination-lg ">

					<!--Arrow left-->
					<li class="page-item hotfilmsfy">
						<a class="page-link" aria-label="Previous">
							<span aria-hidden="true">&laquo;</span>
							<span class="sr-only">Previous</span>
						</a>
					</li>

					<!--Numbers-->
					<li class="page-item hotfilmsfy active">
						<a class="page-link">1</a>
					</li>

					<!--Arrow right-->
					<li class="page-item hotfilmsfy">
						<a class="page-link" aria-label="Next">
							<span aria-hidden="true">&raquo;</span>
							<span class="sr-only">Next</span>
						</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>

	<footer class="page-footer text-center font-small mt-4 wow fadeIn" style="visibility: visible; animation-name: fadeIn;">

		<!--Call to action-->
		<div class="pt-4">
			<a class="btn btn-outline-white waves-effect waves-light" href="https://mdbootstrap.com/getting-started/" target="_blank"
			 role="button">
				<font style="vertical-align: inherit;">
					<font style="vertical-align: inherit;">下载MDB
					</font>
				</font>
				<i class="fa fa-download ml-2"></i>
			</a>
			<a class="btn btn-outline-white waves-effect waves-light" href="https://mdbootstrap.com/bootstrap-tutorial/" target="_blank"
			 role="button">
				<font style="vertical-align: inherit;">
					<font style="vertical-align: inherit;">开始免费教程
					</font>
				</font>
				<i class="fa fa-graduation-cap ml-2"></i>
			</a>
		</div>
		<!--/.Call to action-->

		<hr class="my-4">

		<!-- Social icons -->
		<div class="pb-4">
			<a href="https://www.facebook.com/mdbootstrap" target="_blank">
				<i class="fa fa-facebook mr-3"></i>
			</a>

			<a href="https://twitter.com/MDBootstrap" target="_blank">
				<i class="fa fa-twitter mr-3"></i>
			</a>

			<a href="https://www.youtube.com/watch?v=7MUISDJ5ZZ4" target="_blank">
				<i class="fa fa-youtube mr-3"></i>
			</a>

			<a href="https://plus.google.com/u/0/b/107863090883699620484" target="_blank">
				<i class="fa fa-google-plus mr-3"></i>
			</a>

			<a href="https://dribbble.com/mdbootstrap" target="_blank">
				<i class="fa fa-dribbble mr-3"></i>
			</a>

			<a href="https://pinterest.com/mdbootstrap" target="_blank">
				<i class="fa fa-pinterest mr-3"></i>
			</a>

			<a href="https://github.com/mdbootstrap/bootstrap-material-design" target="_blank">
				<i class="fa fa-github mr-3"></i>
			</a>

			<a href="http://codepen.io/mdbootstrap/" target="_blank">
				<i class="fa fa-codepen mr-3"></i>
			</a>
		</div>
		<!-- Social icons -->

		<!--Copyright-->
		<div class="footer-copyright py-3">
			<font style="vertical-align: inherit;">
				<font style="vertical-align: inherit;">
					©2018版权所有：
				</font>
			</font>
			<a href="https://mdbootstrap.com/bootstrap-tutorial/" target="_blank">
				<font style="vertical-align: inherit;">
					<font style="vertical-align: inherit;">Yip&amp;Tang </font>
				</font>
			</a>
		</div>
		<!--/.Copyright-->

	</footer>

	<!-- /Start your project here-->

	<!-- SCRIPTS -->
	<!-- JQuery -->
	<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
	<!-- Bootstrap tooltips -->
	<script type="text/javascript" src="js/popper.min.js"></script>
	<!-- Bootstrap core JavaScript -->
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<!-- MDB core JavaScript -->
	<script type="text/javascript" src="js/mdb.min.js"></script>

	<script type="text/javascript">
		sessionStorage.setItem("tag", "");//设置标签为全部null
		var url = " http://127.0.0.1:3000/loadfilms/bytag?" + "tag=" + sessionStorage.getItem("tag");
		loadfilms(url);
		//给种类中的标签添加click事件
		var aUnderLi = $("#typetag").find("a");
		aUnderLi.click(function () {
			$(".active").eq(1).removeClass("active");
			sessionStorage.setItem("tag", $(this).attr("value"));
			//根据标签加载电影
			let url = " http://127.0.0.1:3000/loadfilms/bytag?" + "tag=" + sessionStorage.getItem("tag");
			emptyFilms();
			loadfilms(url);
			$(this).parent().addClass("active");
		})

		//搜索电影功能
		$("#basic-text1").click(function () {
			let input = $("#sInput").val();
			console.log(input);
			let url = " http://127.0.0.1:3000/loadfilms/search?" + "input=" + input;
			emptyFilms();
			loadfilms(url);
		})

		function emptyFilms() {
			$("#mainFilms").empty();
		}
		function loadfilms(url) {
			fetch(url, {
				method: "GET"
			}).then(function (res) {
				return res.json();
			}).then(function (jsons) {
				var length = jsons.length;
				var rows = Math.ceil(length / 6);
				for (let i = 0; i < rows; i++) {
					let row = document.createElement("div");
					console.log(row);
					row.className = "row";
					if (length > 6) {
						length = length - 6;
						for (let j = 0; j < 6; j++) {
							let info = jsons[i * 6 + j];
							let col = createOneFilmCard(info);
							row.appendChild(col);
						}
					}
					else {
						for (let j = 0; j < length; j++) {
							let info = jsons[i * 6 + j];
							let col = createOneFilmCard(info);
							row.appendChild(col);
						}
					}
					$("#mainFilms").append(row);
				}
			})
		}

		function createOneFilmCard(info) {
			let col = document.createElement("div");
			col.className = "imgrow col-md-4 col-lg-2 mb-4";
			let card = document.createElement("div");
			card.className = "card hoverable";
			let view = document.createElement("div");
			view.className = "view zoom";
			let img = document.createElement("img");
			img.className = "insertimgs";
			img.setAttribute("src", info.imghref);
			img.setAttribute("style", " border-top-left-radius:3px; border-top-right-radius:3px;");
			let a = document.createElement("a");
			a.setAttribute("href", "./filminfo.html");
			a.setAttribute("value", info.filmid);
			a.addEventListener("click", function () {
				sessionStorage.setItem("filmid", a.getAttribute("value"));
			})
			let div = document.createElement("div");
			div.className = "mask rgba-white-slight waves-effect waves-light";
			a.appendChild(div);
			view.appendChild(img);
			view.appendChild(a);
			card.appendChild(view);

			let body = document.createElement("div");
			body.className = "card-body";
			body.setAttribute("style", "padding:10px")
			let p = document.createElement("p");
			p.className = "card-title";
			p.setAttribute("style", "text-align: center; height:50px; ")
			p.textContent = info.filmname;
			body.appendChild(p);
			card.appendChild(body);

			col.appendChild(card);
			return col;
		}
		//退出账户
		$("#out").click(function () {
			localStorage.removeItem("username");
			localStorage.removeItem("password");
			sessionStorage.removeItem("username");
			sessionStorage.removeItem("username");
			sessionStorage.removeItem("userid");
		})
	</script>
</body>

</html>