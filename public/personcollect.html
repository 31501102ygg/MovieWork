<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>Yip Tang Movie</title>
	<link rel="shortcut icon" href="img/pic/html_16px_1210190_easyicon.net.ico" />
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<!-- Material Design Bootstrap -->
	<link href="css/mdb.min.css" rel="stylesheet">
	<!-- Your custom styles (optional) -->
	<link href="css/style.css" rel="stylesheet">

	<style type="text/css">
		.collections {
			margin-top: 70px;
			/* background-image: url("http://ms0.meituan.net/mywww/banner_bg.f7fd103e3b8c16b6f449cce43fc57f45.png"); */
		}

		.page-footer,
		.top-nav-collapse {
			background-color: #4285f4;
		}
	</style>
</head>

<body>
	<!--Navbar-->
	<nav class="navbar navbar-expand-lg navbar-dark blue darken-3 fixed-top scrolling-navbar">
		<div class="container">
			<!-- Navbar brand -->
			<a class="navbar-brand" href="#">
				<img src="img/pic/logo.png">
			</a>

			<!-- Collapse button -->
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav" aria-controls="basicExampleNav"
			 aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<!-- Collapsible content -->
			<div class="collapse navbar-collapse" id="basicExampleNav">

				<!-- Links -->
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="nav-link" href="./main1.html">热映电影
							<span class="sr-only">(current)</span>
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="./searchfilms.html">寻找电影</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="./filmreview.html">影评</a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="./personcollect.html">个人收藏</a>
					</li>
					<!-- Dropdown -->
					<!--<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
						<div class="dropdown-menu dropdown-primary" aria-labelledby="navbarDropdownMenuLink">
							<a class="dropdown-item" href="#">Action</a>
							<a class="dropdown-item" href="#">Another action</a>
							<a class="dropdown-item" href="#">Something else here</a>
						</div>
					</li>-->

				</ul>
				<!-- Links -->
				<ul class="navbar-nav mr-auto nav-flex-icons">
					<li class="nav-item">
						<a class="nav-link waves-effect waves-light" href="./aboutus.html">
							<i class="fa fa-gear"></i> 关于我们</a>
					</li>
					<li class="nav-item">
						<a class="nav-link waves-effect waves-light" href="./contact.html">
							<i class="fa fa-envelope"></i> 联系我们</a>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle waves-effect waves-light" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							<i class="fa fa-user"></i> 用户名称
						</a>
						<div class="dropdown-menu dropdown-menu-right dropdown-default" aria-labelledby="navbarDropdownMenuLink">
							<a class="dropdown-item waves-effect waves-light" href="./account.html">我的账号</a>
							<a class="dropdown-item waves-effect waves-light" href="#">退出</a>
						</div>
					</li>
				</ul>
			</div>
			<!-- Collapsible content -->
		</div>
	</nav>
	<!--/.Navbar-->
	<!--/.container-->
	<div class="collections">
		<div id="collectfilms" class="container"></div>
	</div>
	<!--/.endcontainer-->
	<div class="dtfy">
		<div class="container">

			<nav class="flex-center ">
				<ul class="pagination pg-blue pagination-circle pagination-lg ">

					<!--Arrow left-->
					<li class="page-item hotfilmsfy">
						<a class="page-link" aria-label="Previous">
							<span aria-hidden="true">&laquo;</span>
							<span class="sr-only">Previous</span>
						</a>
					</li>

					<!--Numbers-->
					<li class="page-item hotfilmsfy">
						<a class="page-link">1</a>
					</li>

					<!--Arrow right-->
					<li class="page-item hotfilmsfy">
						<a class="page-link" aria-label="Next">
							<span aria-hidden="true">&raquo;</span>
							<span class="sr-only">Next</span>
						</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>

	<footer class="page-footer text-center font-small mt-4 wow fadeIn" style="visibility: visible; animation-name: fadeIn;">

		<!--Call to action-->
		<div class="pt-4">
			<a class="btn btn-outline-white waves-effect waves-light" href="https://mdbootstrap.com/getting-started/" target="_blank"
			 role="button">
				<font style="vertical-align: inherit;">
					<font style="vertical-align: inherit;">下载MDB
					</font>
				</font>
				<i class="fa fa-download ml-2"></i>
			</a>
			<a class="btn btn-outline-white waves-effect waves-light" href="https://mdbootstrap.com/bootstrap-tutorial/" target="_blank"
			 role="button">
				<font style="vertical-align: inherit;">
					<font style="vertical-align: inherit;">开始免费教程
					</font>
				</font>
				<i class="fa fa-graduation-cap ml-2"></i>
			</a>
		</div>
		<!--/.Call to action-->

		<hr class="my-4">

		<!-- Social icons -->
		<div class="pb-4">
			<a href="https://www.facebook.com/mdbootstrap" target="_blank">
				<i class="fa fa-facebook mr-3"></i>
			</a>

			<a href="https://twitter.com/MDBootstrap" target="_blank">
				<i class="fa fa-twitter mr-3"></i>
			</a>

			<a href="https://www.youtube.com/watch?v=7MUISDJ5ZZ4" target="_blank">
				<i class="fa fa-youtube mr-3"></i>
			</a>

			<a href="https://plus.google.com/u/0/b/107863090883699620484" target="_blank">
				<i class="fa fa-google-plus mr-3"></i>
			</a>

			<a href="https://dribbble.com/mdbootstrap" target="_blank">
				<i class="fa fa-dribbble mr-3"></i>
			</a>

			<a href="https://pinterest.com/mdbootstrap" target="_blank">
				<i class="fa fa-pinterest mr-3"></i>
			</a>

			<a href="https://github.com/mdbootstrap/bootstrap-material-design" target="_blank">
				<i class="fa fa-github mr-3"></i>
			</a>

			<a href="http://codepen.io/mdbootstrap/" target="_blank">
				<i class="fa fa-codepen mr-3"></i>
			</a>
		</div>
		<!-- Social icons -->

		<!--Copyright-->
		<div class="footer-copyright py-3">
			<font style="vertical-align: inherit;">
				<font style="vertical-align: inherit;">
					©2018版权所有：
				</font>
			</font>
			<a href="https://mdbootstrap.com/bootstrap-tutorial/" target="_blank">
				<font style="vertical-align: inherit;">
					<font style="vertical-align: inherit;">Yip&amp;Tang </font>
				</font>
			</a>
		</div>
		<!--/.Copyright-->

	</footer>
	<!--主要信息区-->
	<!-- /Start your project here-->
	<!-- Central Modal Medium Success -->
	<div class="modal fade" id="centralModalSuccess" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-notify modal-success" role="document">
			<!--Content-->
			<div class="modal-content">
				<!--Header-->
				<div class="modal-header primary-color">
					<p class="heading lead">评分</p>

					<button id="modal-close" type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true" class="white-text">&times;</span>
					</button>
				</div>

				<!--Body-->
				<div class="modal-body">
					<div class="text-center">
						<i class="fa fa-tv fa-4x mb-3 animated rotateIn"></i>
					</div>
					<div class="md-form">
						<!-- Default input -->
						<i class="fa fa-pencil prefix"></i>
						<label for="exampleForm2">评分(10以内)</label>
						<input type="text" id="yourscore" class="form-control">
					</div>
					<div class="md-form">
						<i class="fa fa-commenting prefix"></i>
						<textarea type="text" id="yourcomment" class="form-control md-textarea" rows="3"></textarea>
						<label for="textareaPrefix" class="">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">电影短评</font>
							</font>
						</label>
					</div>
				</div>

				<!--Footer-->
				<div class="modal-footer justify-content-center">
					<a id="pj-submit" type="button" class="btn btn-primary">提交 </a>
					<a type="button" class="btn btn-outline-primary waves-effect" data-dismiss="modal">取消</a>
				</div>
			</div>
			<!--/.Content-->
		</div>
	</div>
	<!-- SCRIPTS -->
	<!-- JQuery -->
	<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
	<!-- Bootstrap tooltips -->
	<script type="text/javascript" src="js/popper.min.js"></script>
	<!-- Bootstrap core JavaScript -->
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<!-- MDB core JavaScript -->
	<script type="text/javascript" src="js/mdb.min.js"></script>
	<script type="text/javascript">
		console.log(sessionStorage.getItem("username"))
		var filmid = sessionStorage.getItem("filmid");
		console.log(filmid);
		$("#navbarDropdownMenuLink").html('<i class="fa fa-user"></i>' + sessionStorage.getItem("username"));
		$("#img123").click(function () {
			console.log("over")
			$(this).attr("disabled", "disabled");
		})

		//添加分页标签
		var url = " http://127.0.0.1:3000/collect/searchnumber?" + "userid=" + sessionStorage.getItem("userid");
		fetch(url, {
			method: "GET"
		}).then(function (res) {
			return res.json();
		}).then(function (json) {
			let number = json[0];
			number = number["COUNT(filmid)"];
			console.log(number);
			var index = Math.ceil(number / 9);//分页每一页9个电影
			$(".page-item").eq(0).click(function () {
				$("#collectfilms").empty();
				let length = document.getElementsByClassName("page-item").length - 2;
				console.log(length);
				let index1 = $(".active").eq(1).children("a").text();
				console.log(index1);
				if (index1 == 1)
					index1 = length;
				else
					index1--;
				loadbyindex(index1);
				$(".active").eq(1).removeClass("active");
				let items = document.getElementsByClassName("page-item");
				items[index1].className = items[index1].className + " active";
			})
			$(".page-item").eq(1).click(function () {
				$("#collectfilms").empty();
				loadbyindex(1);
				console.log($(".active").eq(0))
				$(".active").eq(1).removeClass("active");
				$(this).addClass("active");
			})
			$(".page-item").eq(2).click(function () {
				$("#collectfilms").empty();
				let length = document.getElementsByClassName("page-item").length - 2;
				let index1 = $(".active").eq(1).children("a").text();
				if (index1 == length)
					index1 = 1;
				else
					index1++;
				loadbyindex(index1);
				$(".active").eq(1).removeClass("active");
				let items = document.getElementsByClassName("page-item");
				items[index1].className = items[index1].className + " active";
			})
			if (index > 1) {
				for (let i = 2; i <= index; i++) {
					let ei = document.createElement("i");
					ei.className = "page-item hotfilmsfy";
					let a = document.createElement("a");
					a.className = "page-link";
					a.textContent = i;
					a.addEventListener("click", function () {
						$("#collectfilms").empty();
						let index = $(this).text();
						console.log(index);
						loadbyindex(index);
						$(".active").eq(1).removeClass("active");
						$(this).parent().addClass("active");
					})
					ei.appendChild(a);
					$(".page-item").eq(i - 1).after(ei);
				}
			}
			$(".page-item").eq(1).click();
		}).catch(function (ex) {
			console.log('parsing failed: ', ex);
		})

		//插入收藏的电影图片信息
		function loadbyindex(index) {
			url = " http://127.0.0.1:3000/collect/loadcollectbyindex?" + "userid=" + sessionStorage.getItem("userid") + "&index=" + index;
			fetch(url, {
				method: "GET"
			}).then(function (res) {
				return res.json();
			}).then(function (json) {
				console.log(json);
				let number = json.length;
				let rows = Math.ceil(number / 3);
				if (number == 0) {
					let div1 = document.createElement("div");
					div1.className = "flex-center flex-column";
					div1.setAttribute("style", "height:100vh");
					let h1 = document.createElement("h1");
					h1.className = "animated fadeIn mb-4";
					h1.textContent = "您还没有收藏过电影";
					div1.appendChild(h1);
					$("#collectfilms").append(div1);
					$(".dtfy").eq(0).attr("style", "display: none");
				}
				else {
					let div1 = document.createElement("div");
					div1.className = "flex-column";
					div1.setAttribute("style", "margin-top:130px;margin-bottom:40px;color:black;padding-left: 10px;");
					let h1 = document.createElement("h1");
					h1.className = "animated fadeIn mb-1";
					h1.innerHTML = "<i class='fa  fa-youtube-play' style='color: #ff3d00;margin-right:10px;'></i>" + "收藏的电影";
					let p = document.createElement("p");
					p.textContent = "You can check your collections of movies here";
					p.setAttribute("style", "font-size:20px")
					div1.appendChild(h1);
					div1.appendChild(p);
					$("#collectfilms").append(div1);
				}
				for (let i = 0; i < rows; i++) {
					let div1 = document.createElement("div");
					div1.className = "row";
					if (number > 3) {
						number = number - 3;
						for (let j = 0; j < 3; j++) {
							let json1 = json[3 * i + j];
							let div2 = document.createElement("div");
							div2.className = "col-lg-4 col-md-6 mb-4";
							let div3 = document.createElement("div");
							div3.className = "card hoverable";
							let div4 = document.createElement("div");
							div4.className = "view overlay";
							let img1 = document.createElement("img");
							img1.className = "card-img-top";
							img1.setAttribute("src", json1.imghref);
							img1.setAttribute("style", "height:410px");
							let a = document.createElement("a");
							a.setAttribute("href", "./filminfo.html");
							a.setAttribute("value", json1.filmid);
							a.addEventListener("click", function () {
								sessionStorage.setItem("filmid", a.getAttribute("value"));

								console.log(sessionStorage.getItem("filmid"));
							})
							let div5 = document.createElement("div");
							div5.className = "mask rgba-white-slight waves-effect waves-light";
							a.appendChild(div5);
							div4.appendChild(img1);
							div4.appendChild(a);
							div3.appendChild(div4);
							let div6 = document.createElement("div");
							div6.className = "card-body";
							let h4 = document.createElement("h4");
							h4.className = "card-title";
							h4.textContent = json1.filmname;
							let score = document.createElement("p");
							score.className = "card-text";
							let stars = addStar(json1.score);
							score.innerHTML = "评分：" + stars.innerHTML;
							div6.appendChild(h4);
							div6.appendChild(score);
							div3.appendChild(div6);
							div2.appendChild(div3);
							div1.appendChild(div2);
						}
					}
					else {
						for (let j = 0; j < number; j++) {
							let json1 = json[3 * i + j];
							let div2 = document.createElement("div");
							div2.className = "col-lg-4 col-md-6 mb-4";
							let div3 = document.createElement("div");
							div3.className = "card";
							let div4 = document.createElement("div");
							div4.className = "view overlay";
							let img1 = document.createElement("img");
							img1.className = "card-img-top";
							img1.setAttribute("src", json1.imghref);
							img1.setAttribute("style", "height:410px");
							let a = document.createElement("a");
							a.setAttribute("href", "./filminfo.html");
							a.setAttribute("value", json1.filmid);
							a.addEventListener("click", function () {
								sessionStorage.setItem("filmid", a.getAttribute("value"));
							})
							let div5 = document.createElement("div");
							div5.className = "mask rgba-white-slight waves-effect waves-light";
							a.appendChild(div5);
							div4.appendChild(img1);
							div4.appendChild(a);
							div3.appendChild(div4);
							let div6 = document.createElement("div");
							div6.className = "card-body";
							let h4 = document.createElement("h4");
							h4.className = "card-title";
							h4.textContent = json1.filmname;
							let score = document.createElement("p");
							score.className = "card-text";
							let stars = addStar(json1.score);
							score.innerHTML = "评分：" + stars.innerHTML;
							div6.appendChild(h4);
							div6.appendChild(score);
							div3.appendChild(div6);
							div2.appendChild(div3);
							div1.appendChild(div2);
						}
					}
					$("#collectfilms").append(div1);
				}
			})
		}
		function addStar(score) {
			let pj = document.createElement("p");
			let score1 = Math.floor(score / 2);
			let score2 = Math.round(score / 2);
			let bool = score2 > score1 ? true : false;
			for (let j = 0; j < score1; j++) {
				let ei = document.createElement("i");
				ei.className = "fa fa-star ";
				ei.setAttribute("style", "color: #fdd835");
				pj.appendChild(ei);
			}
			if (bool) {
				let ei = document.createElement("i");
				ei.className = "fa fa-star-half-full";
				ei.setAttribute("style", "color: #fdd835");
				pj.appendChild(ei);
			}
			ei = document.createElement("i");
			ei.textContent = score;
			pj.appendChild(ei);
			return pj;
		}
		//退出账户
		$("#out").click(function () {
			localStorage.removeItem("username");
			localStorage.removeItem("password");
			sessionStorage.removeItem("username");
			sessionStorage.removeItem("username");
			sessionStorage.removeItem("userid");
		})
	</script>
</body>

</html>