<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>Yip Tang Movie</title>
	<link rel="shortcut icon" href="img/pic/html_16px_1210190_easyicon.net.ico" />
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<!-- Material Design Bootstrap -->
	<link href="css/mdb.min.css" rel="stylesheet">
	<!-- Your custom styles (optional) -->
	<link href="css/style.css" rel="stylesheet">
	<style type="text/css">
		.view {
			height: 100vh;
			overflow: hidden;
		}

		.navbar {
			background-color: rgba(0, 0, 0, .3);
		}
	</style>
</head>

<body>
	<!--Navbar-->
	<nav class="navbar navbar-expand-lg navbar-dark lighten-5 fixed-top scrolling-navbar">
		<div class="container">
			<!-- Navbar brand -->
			<a class="navbar-brand" href="#">
				<img src="img/pic/logo.png">
			</a>

			<!-- Collapse button -->
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav" aria-controls="basicExampleNav"
			 aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<!-- Collapsible content -->
			<div class="collapse navbar-collapse" id="basicExampleNav">

				<!-- Links -->
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="nav-link" href="./main1.html">热映电影
							<span class="sr-only">(current)</span>
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="./searchfilms.html">寻找电影</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="./filmreview.html">影评</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="./personcollect.html">个人收藏</a>
					</li>
					<!-- Dropdown -->
					<!--<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
					<div class="dropdown-menu dropdown-primary" aria-labelledby="navbarDropdownMenuLink">
						<a class="dropdown-item" href="#">Action</a>
						<a class="dropdown-item" href="#">Another action</a>
						<a class="dropdown-item" href="#">Something else here</a>
					</div>
				</li>-->

				</ul>
				<!-- Links -->
				<ul class="navbar-nav mr-auto nav-flex-icons">
					<li class="nav-item">
						<a class="nav-link waves-effect waves-light" href="./aboutus.html">
							<i class="fa fa-gear"></i> 关于我们</a>
					</li>
					<li class="nav-item">
						<a class="nav-link waves-effect waves-light" href="./contact.html">
							<i class="fa fa-envelope"></i> 联系我们</a>
					</li>
					<li class="nav-item dropdown active">
						<a class="nav-link dropdown-toggle waves-effect waves-light" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
						 aria-expanded="true">
							<i class="fa fa-user"></i> 用户名称
						</a>
						<div class="dropdown-menu dropdown-menu-right dropdown-default" aria-labelledby="navbarDropdownMenuLink">
							<a class="dropdown-item waves-effect waves-light" href="./account.html">我的账号</a>
							<a class="dropdown-item waves-effect waves-light" href="http://localhost:3000">退出</a>
						</div>
					</li>
				</ul>
			</div>
			<!-- Collapsible content -->
		</div>
	</nav>
	<div class="view full-page-intro" style="background-image: url(img/pic/marvel.jpg); background-repeat: no-repeat; background-size: cover;">

		<!-- Mask & flexbox options-->
		<div class="mask rgba-black-light d-flex justify-content-center align-items-center">

			<!-- Content -->
			<div class="container">

				<!--Grid row-->
				<div class="row wow fadeIn" style="visibility: visible; animation-name: fadeIn;">

					<!--Grid column-->
					<div class="col-md-6 mb-4 white-text text-center text-md-left">

						<h1 class="display-4 font-weight-bold">Yip&amp;Tang Movie Site</h1>

						<hr class="hr-light">

						<p>
							<strong>我的资料</strong>
						</p>

						<p class="mb-4 d-none d-md-block animated fadeIn">
							<strong>在这里您可以设置自己的资料信息</strong>
						</p>

						<!--<a target="_blank" href="https://mdbootstrap.com/bootstrap-tutorial/" class="btn btn-indigo btn-lg waves-effect waves-light">Start free tutorial
              <i class="fa fa-graduation-cap ml-2"></i>
            </a>-->

					</div>
					<!--Grid column-->

					<!--Grid column-->
					<div class="col-md-6 col-xl-5 mb-4">

						<!--Card-->
						<div class="card">

							<!--Card content-->
							<div class="card-body">

								<!-- Form -->
								<form>
									<!-- Heading -->
									<h3 class="dark-grey-text text-center">
										<strong>我的资料</strong>
									</h3>
									<hr>
									<table style="clear:both" width="100%" align="center" cellpadding="5">
										<tbody>
											<tr>
												<td class="m" align="center">
													<strong>账号: </strong>
												</td>
												<td id="tdusername" maxlength="15">
													<i class="username"></i>
													<strong>用户账号</strong>
												</td>
											</tr>
											<tr>
												<td class="m" align="center">
													<strong>昵称: </strong>
												</td>
												<td id="tdnickname" size="15" maxlength="15">
													<i class="nickname"></i>
													<strong>用户昵称</strong>
												</td>
											</tr>
											<tr>
												<td class="m" align="center">
													<strong>性别: </strong>
												</td>
												<td id="tdsex" size="15" maxlength="15">
													<i class="sex"></i>
													<strong>用户性别</strong>
												</td>
											</tr>
											<tr>
												<td class="m" align="center">
													<strong>年龄: </strong>
												</td>
												<td id="tdage" size="15" maxlength="15">
													<i class="age"></i>
													<strong>用户年龄</strong>
												</td>
											</tr>
											<tr>
												<td class="m" align="center">
													<strong>居住地: </strong>
												</td>
												<td id="tdlocal" size="15" maxlength="15">
													<i class="local"></i>
													<strong>用户居住地</strong>
												</td>
											</tr>

											<tr>
												<td class="m" align="center">
													<strong>职业: </strong>
												</td>
												<td id="tdjob" size="15" maxlength="15">
													<i class="job"></i>
													<strong>用户职业</strong>
												</td>
											</tr>

											<tr>
												<td class="m" align="center">
													<strong>个性签名: </strong>
												</td>
												<td id="tdmotto" size="15" maxlength="15">
													<i class="motto"></i>
													<strong>用户个性签名</strong>
												</td>
											</tr>


										</tbody>
									</table>
									<div class="text-center mt-3 mb-3">
										<button id="modify" class="btn btn-indigo waves-effect waves-light " type="button">修改信息</button>
									</div>
								</form>
								<!-- Form -->

							</div>

						</div>
						<!--/.Card-->

					</div>
					<!--Grid column-->

				</div>
				<!--Grid row-->

			</div>
			<!-- Content -->

		</div>
		<!-- Mask & flexbox options-->

	</div>
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form id="modify" class="ajax-auth card p-0" action="modify" method="post" novalidate="novalidate">
					<div class="card-body mx-4">
						<div class="text-center">
							<h3 class="dark-grey-text mb-3">
								<strong>个人资料修改</strong>
							</h3>
						</div>

						<p class="status"></p>
						<input type="hidden" id="modifysecurity" name="modifysecurity" value="8334571d2a">
						<input type="hidden" name="_wp_http_referer" value="/components/">
						<div class="md-form">
							<i class="fa fa-user prefix grey-text"></i>
							<input type="text" id="nickname" class="form-control">
							<label for="modifynickname">昵称</label>
						</div>

						<div class="md-form">
							<i class="fa fa-male prefix grey-text"></i>
							<input type="text" id="sex" class="form-control">
							<label for="modifysex">性别</label>
						</div>

						<div class="md-form">
							<i class="fa fa-anchor prefix grey-text"></i>
							<input type="text" id="age" class="form-control">
							<label for="modifyage">年龄</label>
						</div>
						<div class="md-form">
							<i class="fa fa-home prefix grey-text"></i>
							<input type="text" id="local" class="form-control">
							<label for="modifylocal">居住地</label>
						</div>
						<div class="md-form">
							<i class="fa fa-road prefix grey-text"></i>
							<input type="text" id="job" class="form-control">
							<label for="modifyjob">职业</label>
						</div>
						<div class="md-form">
							<i class="fa fa-info prefix grey-text"></i>
							<input type="text" id="motto" class="form-control">
							<label for="modifymotto">个性签名</label>
						</div>
						<div class="text-center mt-3 mb-3">
							<button id="modifyon" class="btn btn-indigo waves-effect waves-light " type="button">确认修改</button>
						</div>
					</div>
				</form>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal -->
	</div>
	<!-- /Start your project here-->

	<!-- SCRIPTS -->
	<!-- JQuery -->
	<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
	<!-- Bootstrap tooltips -->
	<script type="text/javascript" src="js/popper.min.js"></script>
	<!-- Bootstrap core JavaScript -->
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<!-- MDB core JavaScript -->
	<script type="text/javascript" src="js/mdb.min.js"></script>


	<script type="text/javascript">
		$(document).ready(function () {
			$("#modify").click(function () {
				$("#myModal").modal(Option);
			})
		})		
	</script>
	<script type="text/javascript">
		console.log(sessionStorage.getItem("username"))
		$("#navbarDropdownMenuLink").html('<i class="fa fa-user"></i>' + sessionStorage.getItem("username"));
		var url = "http://127.0.0.1:3000/account/loadaccount?" + "userid=" + sessionStorage.getItem("userid");
		fetch(url, {
			method: "GET"
		}).then(function (res) {
			return res.json();
		}).then(function (json) {
			console.log(json);
			$("#tdnickname").text(json[0].nickname);
			$("#tdsex").text(json[0].sex);
			$("#tdage").text(json[0].age);
			$("#tdlocal").text(json[0].local);
			$("#tdjob").text(json[0].job);
			$("#tdmotto").text(json[0].motto);
			return json;
		}).catch(function (error) {
			console.log('parsing failed: ', error);
		});
		$("#tdusername").html('<i class="username"></i>' + sessionStorage.getItem("username"));
		$("#modifyon").click(function () {
			let userid = sessionStorage.getItem("userid");
			let nickname = $("#nickname").val();
			let sex = $("#sex").val();
			let age = $("#age").val();
			let local = $("#local").val();
			let job = $("#job").val();
			let motto = $("#motto").val();
			let url = "http://127.0.0.1:3000/account/modifyaccount";
			fetch(url, {
				method: "POST",
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					"userid": userid,
					"nickname": nickname,
					"sex": sex,
					"age": age,
					"local": local,
					"job": job,
					"motto": motto
				})
			}).then(function (response) {
				$("#myModal").modal('hide');
			}).catch(function (ex) {
				console.log("print ex:" + ex);
			})
		})
		//退出账户
		$("#out").click(function () {
			localStorage.removeItem("username");
			localStorage.removeItem("password");
			sessionStorage.removeItem("username");
			sessionStorage.removeItem("username");
			sessionStorage.removeItem("userid");
		})
	</script>
</body>

</html>